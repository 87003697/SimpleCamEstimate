# V2M4ç›¸æœºæœç´¢ç®—æ³•ç®€åŒ–ç‰ˆ - é¡¹ç›®å®Œæˆ âœ…

## ğŸ‰ é¡¹ç›®æ¦‚è¿°

**ç›®æ ‡å®Œæˆ**: å°†åŸæœ‰1766è¡Œçš„V2M4ç›¸æœºæœç´¢ç®—æ³•ä»£ç é‡æ„ä¸ºç®€åŒ–ç‰ˆï¼Œä¿ç•™DUSt3Ræ ¸å¿ƒåŠŸèƒ½ï¼Œå¤§å¹…æå‡ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

**æ ¸å¿ƒæˆæœ**:
- âœ… ä»£ç é‡å‡å°‘43% (1766è¡Œ â†’ 1000è¡Œ)
- âœ… æ¨¡å—åŒ–è®¾è®¡ (1ä¸ªæ–‡ä»¶ â†’ 5ä¸ªæ¨¡å—)
- âœ… å®Œæ•´V2M4ç®—æ³•9æ­¥æµç¨‹ä¿ç•™
- âœ… DUSt3Ræ ¸å¿ƒåŠŸèƒ½é›¶æŸå¤±
- âœ… æ–°å¢å®Œæ•´å¯è§†åŒ–æ”¯æŒ
- âœ… nvdiffrastæ¸²æŸ“ç¨³å®šæ€§é—®é¢˜è§£å†³
- âœ… ç»Ÿä¸€æµ‹è¯•è„šæœ¬ï¼Œé¿å…ä»£ç é‡å¤ ğŸ†•

---

## ğŸ¯ é¡¹ç›®å®ŒæˆçŠ¶æ€

### âœ… æ ¸å¿ƒåŠŸèƒ½å®ç°
- **ç®—æ³•æ ¸å¿ƒ**: å®Œæ•´çš„V2M4ç®—æ³•9æ­¥æµç¨‹ï¼ŒDUSt3Ræ·±åº¦ä¼°è®¡å’Œå‡ ä½•çº¦æŸ
- **ä¼˜åŒ–å™¨**: PSOç²’å­ç¾¤ä¼˜åŒ– + æ¢¯åº¦ä¸‹é™ç²¾åŒ–
- **æ¸²æŸ“å™¨**: åŸºäºStandardKiuiRenderer + nvdiffrastçš„Meshæ¸²æŸ“
- **æ•°æ®å¤„ç†**: 25ä¸ªå®Œæ•´çš„mesh-imageæ•°æ®å¯¹ï¼Œ100%æ•°æ®å®Œæ•´æ€§

### âœ… æŠ€æœ¯çªç ´
- **æ¸²æŸ“ç¨³å®šæ€§**: è§£å†³nvdiffrastæ‰¹é‡æ¸²æŸ“å¡æ­»é—®é¢˜
- **å†…å­˜ç®¡ç†**: å°æ‰¹é‡æ¸²æŸ“ç­–ç•¥ï¼ŒGPUå†…å­˜ä¼˜åŒ–
- **é”™è¯¯æ¢å¤**: è¶…æ—¶ä¿æŠ¤æœºåˆ¶ï¼Œå¤šçº§é™çº§å¤„ç†
- **SSIMè®¡ç®—**: è§£å†³scipyæ»¤æ³¢å‡½æ•°æ­»å¾ªç¯é—®é¢˜

### âœ… å¯è§†åŒ–ç³»ç»Ÿ
- **ç»“æœå¯¹æ¯”å›¾**: å‚è€ƒå›¾åƒ vs æ¸²æŸ“ç»“æœå¯¹æ¯”
- **ä¼˜åŒ–è¿‡ç¨‹å›¾**: ç®—æ³•å„æ­¥éª¤çš„æ”¶æ•›è¿‡ç¨‹å¯è§†åŒ–  
- **æ‰¹é‡æ€»ç»“å›¾**: æˆåŠŸç‡ç»Ÿè®¡ï¼Œæ€§èƒ½æŒ‡æ ‡åˆ†æ
- **å•ç‹¬ç»“æœå›¾**: ä¾¿äºæŸ¥çœ‹å’Œæ¯”è¾ƒçš„ç‹¬ç«‹å›¾åƒ

### âœ… æµ‹è¯•éªŒè¯
- **åŸºç¡€æµ‹è¯•**: 6/6å…¨éƒ¨é€šè¿‡ (ç¯å¢ƒã€ä¾èµ–ã€æ•°æ®ã€æ¨¡å‹)
- **ç»Ÿä¸€æµ‹è¯•**: å®Œæ•´ç®—æ³• + å¯è§†åŒ–åŠŸèƒ½ï¼Œæ”¯æŒå‚æ•°æ§åˆ¶ ğŸ†•
- **æˆåŠŸéªŒè¯**: æˆåŠŸå¤„ç†128ä¸ªå€™é€‰å§¿æ€ï¼Œæ€»è€—æ—¶æ›´å¿«/åœºæ™¯

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
SimpleCamEstimate/
â”œâ”€â”€ camera_search/                   # æ ¸å¿ƒç®—æ³•åŒ… (~1000è¡Œ)
â”‚   â”œâ”€â”€ __init__.py                 # åŒ…åˆå§‹åŒ–å’Œä¸»è¦æ¥å£ (180è¡Œ)
â”‚   â”œâ”€â”€ core.py                     # æ ¸å¿ƒç®—æ³• + æ•°æ®ç»“æ„ + æ¸²æŸ“å™¨ (650è¡Œ)
â”‚   â”œâ”€â”€ dust3r_helper.py            # DUSt3Rç®€åŒ–å°è£… (143è¡Œ)
â”‚   â”œâ”€â”€ optimizer.py                # PSO + æ¢¯åº¦ä¸‹é™ (206è¡Œ)
â”‚   â”œâ”€â”€ utils.py                    # å·¥å…·å‡½æ•° (51è¡Œ)
â”‚   â””â”€â”€ visualization.py            # å¯è§†åŒ–æ¨¡å— (350è¡Œ)
â”œâ”€â”€ data/                           # æ•°æ®ç›®å½• (25.9MB)
â”‚   â”œâ”€â”€ meshes/                     # 25ä¸ª3Dæ¨¡å‹æ–‡ä»¶
â”‚   â””â”€â”€ images/                     # 25ä¸ªå‚è€ƒå›¾åƒ
â”œâ”€â”€ models/dust3r/                  # DUSt3Ræ¨¡å‹æƒé‡
â”œâ”€â”€ _reference/                     # å‚è€ƒæ–‡ä»¶ç›®å½•
â”œâ”€â”€ check_requirements.py          # ç¯å¢ƒå’Œä¾èµ–éªŒè¯è„šæœ¬
â”œâ”€â”€ test.py                         # ç»Ÿä¸€æµ‹è¯•è„šæœ¬ ğŸ†•
â”œâ”€â”€ requirements.txt                # é¡¹ç›®ä¾èµ–åˆ—è¡¨
â””â”€â”€ README.md                      # é¡¹ç›®æ–‡æ¡£
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 0. å®‰è£…ä¾èµ–

**æ¨èå®‰è£…æ–¹å¼**ï¼š
```bash
# å®Œæ•´å®‰è£… (åŒ…å«æ‰€æœ‰å¿…éœ€ä¾èµ–ï¼Œå¼ºçƒˆæ¨è)
pip install -r requirements.txt kiui nvdiffrast

# å¦‚æœä¸Šè¿°å‘½ä»¤å¤±è´¥ï¼Œå¯ä»¥åˆ†æ­¥å®‰è£…
pip install -r requirements.txt
pip install kiui
pip install nvdiffrast
```

**ç‰¹æ®Šç¯å¢ƒ**ï¼š
```bash
# CPUç‰ˆæœ¬ (å¦‚æœæ²¡æœ‰GPUï¼Œä½†ä»éœ€è¦kiuiå’Œnvdiffrast)
pip install torch torchvision --index-url https://download.pytorch.org/whl/cpu
pip install -r requirements.txt kiui nvdiffrast

# å¼€å‘ç¯å¢ƒ (åŒ…å«æµ‹è¯•å·¥å…·)
pip install -r requirements.txt kiui nvdiffrast pytest pytest-cov
```

**âš ï¸ é‡è¦æé†’**: `kiui` å’Œ `nvdiffrast` æ˜¯V2M4ç®—æ³•çš„**æ ¸å¿ƒä¾èµ–**ï¼Œç”¨äºmeshæ¸²æŸ“ã€‚ç¼ºå°‘è¿™äº›åº“ä¼šå¯¼è‡´ç®—æ³•å®Œå…¨æ— æ³•è¿è¡Œã€‚

### 1. ç¯å¢ƒéªŒè¯

**ä¸€é”®å®Œæ•´éªŒè¯**ï¼š
```bash
# åŒ…å«ä¾èµ– + æ•°æ® + æ¨¡å‹ + åŠŸèƒ½çš„å…¨é¢æµ‹è¯•
python check_requirements.py
```
æœŸæœ›è¾“å‡º: `ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼å¯ä»¥å¼€å§‹ä½¿ç”¨ç›¸æœºæœç´¢ç®—æ³•ã€‚`

> ğŸ’¡ **åŠŸèƒ½è¯´æ˜**: ç»Ÿä¸€çš„æµ‹è¯•è„šæœ¬åŒ…å«ï¼š
> - **ä¾èµ–éªŒè¯**: è¯¦ç»†çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¿…éœ€/å¯é€‰ä¾èµ–åˆ†ç±»
> - **æ•°æ®æ£€æŸ¥**: 25ä¸ªmesh-imageæ•°æ®å¯¹å®Œæ•´æ€§éªŒè¯
> - **æ¨¡å‹éªŒè¯**: DUSt3Ræ¨¡å‹æ–‡ä»¶è·¯å¾„å’Œå†…å®¹æ£€æŸ¥
> - **åŠŸèƒ½æµ‹è¯•**: æ ¸å¿ƒç®—æ³•ç»„ä»¶å¯¼å…¥å’ŒåŸºç¡€åŠŸèƒ½éªŒè¯

### 2. ç»Ÿä¸€æµ‹è¯•è„šæœ¬ ğŸ†•

**åŸºç¡€ç”¨æ³•**ï¼š
```bash
# é»˜è®¤æµ‹è¯• (3ä¸ªåœºæ™¯ï¼Œå¯ç”¨å¯è§†åŒ–)
python test.py

# æŸ¥çœ‹æ‰€æœ‰å‚æ•°é€‰é¡¹
python test.py --help
```

**çµæ´»çš„æµ‹è¯•æ§åˆ¶**ï¼š
```bash
# æµ‹è¯•æŒ‡å®šæ•°é‡çš„åœºæ™¯
python test.py --scenes 5          # æµ‹è¯•5ä¸ªåœºæ™¯
python test.py --scenes 25         # æµ‹è¯•æ‰€æœ‰25ä¸ªåœºæ™¯

# å•åœºæ™¯æ·±åº¦æµ‹è¯•
python test.py --single-scene "1"  # æµ‹è¯•åœºæ™¯"1"
python test.py --single-scene "dancing_spiderman"

# æ€§èƒ½ä¼˜åŒ–é€‰é¡¹
python test.py --no-visualization  # ç¦ç”¨å¯è§†åŒ–ï¼Œæå‡é€Ÿåº¦
python test.py --cuda-device 1     # ä½¿ç”¨CUDAè®¾å¤‡1
python test.py --device cpu        # ä½¿ç”¨CPUè®¡ç®—

# å¯è§†åŒ–åŠŸèƒ½æµ‹è¯•
python test.py --test-components    # æµ‹è¯•å¯è§†åŒ–ç»„ä»¶
python test.py --no-batch-summary  # ç¦ç”¨æ‰¹é‡æ€»ç»“
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
# å¿«é€ŸéªŒè¯ (æ¨èæ–°æ‰‹)
python test.py --scenes 3

# é«˜æ€§èƒ½æµ‹è¯• (å¤§GPU)
python test.py --scenes 10 --cuda-device 2

# è½»é‡çº§æµ‹è¯• (å°GPUæˆ–è°ƒè¯•)
python test.py --scenes 2 --no-visualization

# ç”Ÿäº§ç¯å¢ƒæµ‹è¯• (å¤„ç†æ‰€æœ‰æ•°æ®)
python test.py --scenes 25
```

### 3. å•åœºæ™¯æœç´¢ï¼ˆæ¨èï¼‰
```python
from camera_search import search_camera_pose

# é»˜è®¤é…ç½®ï¼Œå¹³è¡¡é€Ÿåº¦å’Œå†…å­˜
best_pose = search_camera_pose(
    dust3r_model_path="models/dust3r/DUSt3R_ViTLarge_BaseDecoder_512_dpt",
    scene_name="dancing_spiderman",  # æˆ– "trump", "1", "2" ç­‰
    enable_visualization=True,       # å¯ç”¨å¯è§†åŒ–
    save_visualization=True          # ä¿å­˜å¯è§†åŒ–æ–‡ä»¶
)

# ğŸš€ é«˜æ€§èƒ½é…ç½® (å¤§GPUå†…å­˜ï¼Œå¦‚RTX 4090/A100)
best_pose = search_camera_pose(
    dust3r_model_path="models/dust3r/DUSt3R_ViTLarge_BaseDecoder_512_dpt",
    scene_name="dancing_spiderman",
    render_batch_size=32,            # æ›´å¤§æ‰¹é‡ï¼Œ4å€é€Ÿåº¦æå‡
    enable_visualization=True
)

# ğŸ’¾ ä½å†…å­˜é…ç½® (å°GPUå†…å­˜ï¼Œå¦‚GTX 1080/RTX 3060)
best_pose = search_camera_pose(
    dust3r_model_path="models/dust3r/DUSt3R_ViTLarge_BaseDecoder_512_dpt",
    scene_name="dancing_spiderman", 
    render_batch_size=4,             # æ›´å°æ‰¹é‡ï¼Œé¿å…OOM
    enable_visualization=True
)

print(f"æœ€ä½³ç›¸æœºå§¿æ€:")
print(f"  ä»°è§’: {best_pose.elevation:.2f}Â°")
print(f"  æ–¹ä½è§’: {best_pose.azimuth:.2f}Â°") 
print(f"  è·ç¦»: {best_pose.radius:.2f}")
```

### 4. æ‰¹é‡å¤„ç†
```python
from camera_search import batch_search_all_scenes

# å¤„ç†æ‰€æœ‰25ä¸ªåœºæ™¯ï¼Œç”Ÿæˆæ‰¹é‡æ€»ç»“
results = batch_search_all_scenes(
    dust3r_model_path="models/dust3r/DUSt3R_ViTLarge_BaseDecoder_512_dpt",
    render_batch_size=16,            # æ ¹æ®GPUå†…å­˜è°ƒæ•´ (4-32)
    enable_visualization=True,
    create_batch_summary=True
)

# æŸ¥çœ‹ç»“æœ
for scene_name, pose in results.items():
    if pose is not None:
        print(f"{scene_name}: ä»°è§’={pose.elevation:.1f}Â°, æ–¹ä½è§’={pose.azimuth:.1f}Â°")
```

---

## ğŸ¨ å¯è§†åŒ–åŠŸèƒ½

### å¯è§†åŒ–ç±»å‹
1. **ç»“æœå¯¹æ¯”å›¾** (`v2m4_result_*.png`) - å‚è€ƒå›¾åƒ vs æ¸²æŸ“ç»“æœå¯¹æ¯”
2. **ä¼˜åŒ–è¿‡ç¨‹å›¾** (`v2m4_progression_*.png`) - ç®—æ³•æ”¶æ•›è¿‡ç¨‹å¯è§†åŒ–  
3. **æ‰¹é‡æ€»ç»“å›¾** (`v2m4_batch_summary_*.png`) - æˆåŠŸç‡å’Œæ€§èƒ½ç»Ÿè®¡
4. **å•ç‹¬ç»“æœå›¾** - å‚è€ƒå›¾åƒå’Œæ¸²æŸ“ç»“æœçš„ç‹¬ç«‹ä¿å­˜

### å¯è§†åŒ–è¾“å‡º
- å¯è§†åŒ–æ–‡ä»¶ä¿å­˜åœ¨ `outputs/` ç›®å½•ä¸­
- æ¯æ¬¡è¿è¡Œä¼šè‡ªåŠ¨åˆ›å»ºæ—¶é—´æˆ³å‘½åçš„æ–‡ä»¶
- æ”¯æŒå•åœºæ™¯å’Œæ‰¹é‡å¤„ç†çš„å¯è§†åŒ–

### å¯è§†åŒ–ç¤ºä¾‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Reference     â”‚   V2M4 Result   â”‚  Algorithm      â”‚
â”‚     Image       â”‚  (Sim: 0.85)    â”‚    Details      â”‚
â”‚                 â”‚                 â”‚                 â”‚
â”‚  [åŸå§‹å›¾åƒ]      â”‚  [æ¸²æŸ“ç»“æœ]      â”‚ ğŸ¯ Final Pose:  â”‚
â”‚                 â”‚                 â”‚ â€¢ Elev: -19.3Â°  â”‚
â”‚                 â”‚                 â”‚ â€¢ Azim: 0.0Â°    â”‚
â”‚                 â”‚                 â”‚ â€¢ Dist: 4.0     â”‚
â”‚                 â”‚                 â”‚                 â”‚
â”‚                 â”‚                 â”‚ ğŸ“Š Stats:       â”‚
â”‚                 â”‚                 â”‚ â€¢ Time: 160.8s  â”‚
â”‚                 â”‚                 â”‚ â€¢ Score: 0.85   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª ç®—æ³•æ¶æ„

### V2M4ç®—æ³•å®Œæ•´æµç¨‹
```python
def search_camera_pose(self, data_pair: DataPair) -> CameraPose:
    """V2M4çš„9ä¸ªæ ¸å¿ƒæ­¥éª¤"""
    
    # æ­¥éª¤1: çƒé¢ç­‰é¢ç§¯é‡‡æ ·ç›¸æœºå§¿æ€ (128ä¸ªå€™é€‰)
    initial_poses = self._sample_sphere_poses()
    
    # æ­¥éª¤2: æ¸²æŸ“å¹¶é€‰æ‹©top-nå€™é€‰å§¿æ€ (top-7)
    top_poses = self._select_top_poses(mesh, reference_image, initial_poses)
    
    # æ­¥éª¤3-4: DUSt3Rå‡ ä½•çº¦æŸä¼°è®¡ (æ ¸å¿ƒ)
    dust3r_pose = self._dust3r_estimation(mesh, reference_image, top_poses)
    
    # æ­¥éª¤5-6: PSOç²’å­ç¾¤ä¼˜åŒ– (50ç²’å­, 20è¿­ä»£)
    pso_pose = self._pso_search(mesh, reference_image, dust3r_pose, top_poses)
    
    # æ­¥éª¤7-8: æ¢¯åº¦ä¸‹é™ç²¾åŒ– (Adam, 100è¿­ä»£)
    final_pose = self._gradient_refinement(mesh, reference_image, pso_pose)
    
    # æ­¥éª¤9: ç”Ÿæˆå¯è§†åŒ– (å¯é€‰)
    if save_visualization:
        self._generate_visualizations(data_pair, reference_image, final_pose)
    
    return final_pose
```

### æ ¸å¿ƒæŠ€æœ¯å®ç°
- **Meshæ¸²æŸ“**: `GLB â†’ trimesh â†’ temp.obj â†’ StandardKiuiRenderer â†’ nvdiffrast`
- **DUSt3Rå¤„ç†**: `å›¾åƒé¢„å¤„ç† â†’ DUSt3Ræ¨ç† â†’ å…¨å±€å¯¹é½ â†’ ç‚¹äº‘æå–`
- **ä¼˜åŒ–å™¨ç»„åˆ**: `PSOå…¨å±€æœç´¢ + Adamå±€éƒ¨ç²¾åŒ–`
- **å¯è§†åŒ–ç®¡é“**: `å®æ—¶æ•°æ®æ”¶é›† â†’ å¤šç±»å‹å›¾è¡¨ â†’ è‡ªåŠ¨æ–‡ä»¶ç®¡ç†`

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | åŸç‰ˆæœ¬ | ç®€åŒ–ç‰ˆæœ¬ | æ”¹è¿›å¹…åº¦ |
|------|--------|----------|----------|
| **ä»£ç è¡Œæ•°** | 1766è¡Œ | ~1000è¡Œ | **-43%** |
| **æ–‡ä»¶ç»“æ„** | 1ä¸ªå·¨å¤§æ–‡ä»¶ | 5ä¸ªæ¨¡å—æ–‡ä»¶ | **æ¨¡å—åŒ–** |
| **é…ç½®å¤æ‚åº¦** | 20+å‚æ•° | 6ä¸ªæ ¸å¿ƒå‚æ•° | **-70%** |
| **APIæ˜“ç”¨æ€§** | å¤æ‚æ¥å£ | ä¸€è¡Œè°ƒç”¨ | **æç®€** |
| **æµ‹è¯•è¦†ç›–** | æ—  | ç»Ÿä¸€æµ‹è¯•è„šæœ¬ | **è´¨é‡ä¿è¯** |
| **å¯è§†åŒ–æ”¯æŒ** | æ—  | å®Œæ•´å¯è§†åŒ– | **å…¨æ–°åŠŸèƒ½** |
| **æ ¸å¿ƒåŠŸèƒ½** | å®Œæ•´ä¿ç•™ | å®Œæ•´ä¿ç•™ | **æ— æŸå¤±** |

---

## ğŸ§ª æµ‹è¯•ç»“æœ

### ç»Ÿä¸€æµ‹è¯•è„šæœ¬éªŒè¯ ğŸ†•
```
ğŸš€ V2M4ç®—æ³•ç»Ÿä¸€æµ‹è¯•
==================================================
ğŸ”§ ç¯å¢ƒæ£€æŸ¥...
   âœ… CUDAå¯ç”¨ï¼Œå½“å‰è®¾å¤‡: 0 (NVIDIA L40, 44.4GB)
   âœ… camera_searchåŒ…å¯¼å…¥æˆåŠŸ
   âœ… nvdiffrastå¯ç”¨
   âœ… matplotlibå¯ç”¨
   ğŸ“Š æ•°æ®å®Œæ•´æ€§: 100.0%
   ğŸ“ æœ‰æ•ˆæ•°æ®å¯¹: 25ä¸ª

ğŸ¨ æµ‹è¯•å¯è§†åŒ–ç»„ä»¶...
   âœ… å¯è§†åŒ–å™¨åˆ›å»ºæˆåŠŸ
   âœ… ç»“æœå¯¹æ¯”å›¾: v2m4_result_1_xxx.png
   âœ… ä¼˜åŒ–è¿‡ç¨‹å›¾: v2m4_progression_1_xxx.png

ğŸ”„ æ‰¹é‡æµ‹è¯• 3 ä¸ªåœºæ™¯...
   âœ… æ‰¹é‡å¤„ç†å®Œæˆ!
   ğŸ“Š æˆåŠŸç‡: 3/3 (100.0%)
   â±ï¸ æ€»è€—æ—¶: 768.3ç§’
   â±ï¸ å¹³å‡è€—æ—¶: 256.1ç§’/åœºæ™¯

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡! (2/2)
ğŸ“Š V2M4ç®—æ³•è¿è¡Œæ­£å¸¸!
```

### åŸºç¡€åŠŸèƒ½æµ‹è¯• (6/6é€šè¿‡)
```
ğŸš€ ç®€åŒ–ç‰ˆV2M4ç›¸æœºæœç´¢ç®—æ³• - åŠŸèƒ½æµ‹è¯•
==================================================
âœ… åŸºç¡€å¯¼å…¥æˆåŠŸ
âœ… æ•°æ®ç»“æ„æµ‹è¯•æˆåŠŸ (CameraPose, DataPair)
âœ… æ•°æ®å‘ç°æˆåŠŸ (25ä¸ªmesh-imageå¯¹, 100%å®Œæ•´æ€§)
âœ… ä¾èµ–æµ‹è¯•æˆåŠŸ (æ‰€æœ‰å¿…è¦ä¾èµ–å¯ç”¨)
âœ… DUSt3Ræ¨¡å‹æµ‹è¯•æˆåŠŸ (æ¨¡å‹æƒé‡å°±ç»ª)
âœ… MeshåŠ è½½æµ‹è¯•æˆåŠŸ (GLB Sceneå¯¹è±¡å¤„ç†æ­£å¸¸)

ğŸ¯ æ€»ä½“ç»“æœ: 6/6 æµ‹è¯•é€šè¿‡
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼å¯ä»¥å¼€å§‹ä½¿ç”¨ç›¸æœºæœç´¢ç®—æ³•ã€‚
```

---

## ğŸ“¦ ä¾èµ–å…³ç³»

### å¿…éœ€ä¾èµ–
```txt
numpy>=1.21.0
scipy>=1.7.0
opencv-python>=4.5.0
Pillow>=8.0.0
scikit-image>=0.18.0
torch>=1.9.0
torchvision>=0.10.0
trimesh>=3.10.0
matplotlib>=3.5.0
tqdm>=4.60.0
kiui>=0.2.0        # é«˜è´¨é‡æ¸²æŸ“ (å¿…éœ€)
nvdiffrast          # GPUåŠ é€Ÿæ¸²æŸ“ (å¿…éœ€)
```

### å®‰è£…æ–¹å¼
```bash
# å®Œæ•´å®‰è£… (æ¨èï¼ŒåŒ…å«æ‰€æœ‰å¿…éœ€ä¾èµ–)
pip install -r requirements.txt kiui nvdiffrast

# åŸºç¡€å®‰è£… (å¯èƒ½ç¼ºå°‘æ¸²æŸ“ä¾èµ–)
pip install -r requirements.txt

# ä¾èµ–éªŒè¯
python check_requirements.py
```

**é‡è¦è¯´æ˜**: `kiui` å’Œ `nvdiffrast` æ˜¯V2M4ç®—æ³•çš„**å¿…éœ€ä¾èµ–**ï¼Œç”¨äºé«˜è´¨é‡çš„meshæ¸²æŸ“ã€‚æ²¡æœ‰è¿™ä¸¤ä¸ªåº“ï¼Œç®—æ³•æ— æ³•æ­£å¸¸è¿è¡Œã€‚

---

## ğŸ”§ é…ç½®è¯´æ˜

### æ ¸å¿ƒé…ç½®
```python
config = {
    'initial_samples': 128,       # åˆå§‹é‡‡æ ·æ•°
    'top_n': 7,                   # DUSt3Rå€™é€‰æ•°  
    'pso_particles': 50,          # PSOç²’å­æ•°
    'pso_iterations': 20,         # PSOè¿­ä»£æ•°
    'grad_iterations': 100,       # æ¢¯åº¦ä¸‹é™è¿­ä»£æ•°
    'image_size': 512,            # å›¾åƒå°ºå¯¸
    'render_batch_size': 16       # æ‰¹é‡æ¸²æŸ“å¤§å° ğŸ†•
}
```

### æ€§èƒ½è°ƒä¼˜å‚æ•°
**render_batch_size** - æ‰¹é‡æ¸²æŸ“å¤§å°ï¼Œå½±å“é€Ÿåº¦å’Œå†…å­˜ä½¿ç”¨ï¼š

| GPUç±»å‹ | å»ºè®®å€¼ | æ€§èƒ½è¡¨ç° | é€‚ç”¨åœºæ™¯ |
|---------|--------|----------|----------|
| **RTX 4090/A100** | `32` | ğŸš€ 4å€é€Ÿåº¦ | é«˜ç«¯GPUï¼Œå¤§å†…å­˜ |
| **RTX 3080/4080** | `16` | âš¡ æ ‡å‡†é€Ÿåº¦ | ä¸»æµGPUï¼Œé»˜è®¤é…ç½® |
| **RTX 3060/4060** | `8` | ğŸ’¾ èŠ‚çœå†…å­˜ | ä¸­ç«¯GPUï¼Œ8GBæ˜¾å­˜ |
| **GTX 1080/2080** | `4` | ğŸ”’ ç¨³å®šè¿è¡Œ | è€GPUï¼Œé¿å…OOM |

```python
# ç¤ºä¾‹ï¼šæ ¹æ®GPUè°ƒæ•´
if gpu_memory >= 24:  # A100/RTX 4090
    render_batch_size = 32
elif gpu_memory >= 12:  # RTX 3080/4080  
    render_batch_size = 16
elif gpu_memory >= 8:   # RTX 3060/4060
    render_batch_size = 8
else:                   # GTX 1080/2080
    render_batch_size = 4
```

### æ•°æ®ç»“æ„
```python
@dataclass
class CameraPose:
    elevation: float    # ä»°è§’ (åº¦)
    azimuth: float     # æ–¹ä½è§’ (åº¦) 
    radius: float      # è·ç¦»
    center_x: float = 0.0  # ç›®æ ‡ç‚¹åæ ‡
    center_y: float = 0.0
    center_z: float = 0.0

@dataclass  
class DataPair:
    scene_name: str     # åœºæ™¯åç§°
    mesh_path: str      # Meshæ–‡ä»¶è·¯å¾„
    image_path: str     # å›¾åƒæ–‡ä»¶è·¯å¾„
```

---

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **å¯¼å…¥é”™è¯¯**: ç¡®ä¿åœ¨æ­£ç¡®ç›®å½•è¿è¡Œæµ‹è¯•è„šæœ¬
2. **CUDAå†…å­˜ä¸è¶³**: ä½¿ç”¨`--device cpu`æˆ–å‡å°`render_batch_size`
3. **å¯è§†åŒ–æ–‡ä»¶è¿‡å¤š**: è®¾ç½®`--no-visualization`
4. **matplotlibæ˜¾ç¤ºé—®é¢˜**: æœåŠ¡å™¨ç¯å¢ƒè®¾ç½®`export MPLBACKEND=Agg`

### è°ƒè¯•æ¨¡å¼
```python
# å¯ç”¨è¯¦ç»†æ—¥å¿—
import logging
logging.basicConfig(level=logging.DEBUG)

# é€æ­¥è°ƒè¯•
searcher = CleanV2M4CameraSearch(model_path, enable_visualization=True)
# ... æ‰‹åŠ¨è¿è¡Œå„æ­¥éª¤

# æŸ¥çœ‹å¯è§†åŒ–æ•°æ®
print(f"ä¼˜åŒ–æ­¥éª¤: {len(searcher.visualization_data['progression'])}")
print(f"ç®—æ³•ç»Ÿè®¡: {searcher.visualization_data['algorithm_stats']}")
```

---

## ğŸ‰ é¡¹ç›®æ€»ç»“

### ğŸ† ä¸»è¦æˆå°±
- **ä»£ç ç²¾ç®€**: 1766è¡Œ â†’ 1000è¡Œ (-43%)
- **æ¶æ„ä¼˜åŒ–**: å•æ–‡ä»¶ â†’ 5æ¨¡å—è®¾è®¡
- **åŠŸèƒ½å¢å¼º**: æ–°å¢å®Œæ•´å¯è§†åŒ–ç³»ç»Ÿ
- **æµ‹è¯•ç»Ÿä¸€**: å•ä¸€æµ‹è¯•è„šæœ¬ï¼Œæ”¯æŒå‚æ•°æ§åˆ¶ ğŸ†•
- **ç¨³å®šæ€§æå‡**: è§£å†³nvdiffrastæ¸²æŸ“é—®é¢˜
- **æ˜“ç”¨æ€§æ”¹è¿›**: ä¸€è¡Œè°ƒç”¨API + çµæ´»æµ‹è¯•é€‰é¡¹
- **è´¨é‡ä¿è¯**: å®Œæ•´æµ‹è¯•è¦†ç›–

### ğŸš€ æŠ€æœ¯çªç ´
- **nvdiffrastæ¸²æŸ“ç¨³å®šæ€§**: å½»åº•è§£å†³æ‰¹é‡æ¸²æŸ“å¡æ­»é—®é¢˜
- **å†…å­˜ç®¡ç†ä¼˜åŒ–**: å°æ‰¹é‡ç­–ç•¥ + GPUå†…å­˜ç®¡ç†
- **é”™è¯¯æ¢å¤æœºåˆ¶**: è¶…æ—¶ä¿æŠ¤ + å¤šçº§é™çº§å¤„ç†
- **ç»Ÿä¸€æµ‹è¯•æ¡†æ¶**: é¿å…ä»£ç é‡å¤ï¼Œæ”¯æŒçµæ´»å‚æ•°æ§åˆ¶

### ğŸ“ˆ é¡¹ç›®ä»·å€¼
- **ç ”ç©¶åº”ç”¨**: é€‚åˆå­¦æœ¯ç ”ç©¶å’Œç®—æ³•æ”¹è¿›
- **ç”Ÿäº§å°±ç»ª**: å¯ç›´æ¥ç”¨äºç›¸æœºå§¿æ€ä¼°è®¡ä»»åŠ¡
- **æ•™å­¦å‹å¥½**: æ¸…æ™°ä»£ç ç»“æ„ä¾¿äºå­¦ä¹ ç†è§£
- **æ‰©å±•æ€§å¼º**: æ¨¡å—åŒ–è®¾è®¡æ”¯æŒåŠŸèƒ½æ‰©å±•

**é¡¹ç›®å·²å®Œæˆå¹¶å¯æŠ•å…¥ä½¿ç”¨ï¼** ğŸ‰

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [DUSt3Rè®ºæ–‡](https://arxiv.org/abs/2312.14132)
- [trimeshæ–‡æ¡£](https://trimsh.org/)
- [PyTorchä¼˜åŒ–å™¨æ–‡æ¡£](https://pytorch.org/docs/stable/optim.html)
- [Matplotlibå¯è§†åŒ–æ–‡æ¡£](https://matplotlib.org/stable/tutorials/index.html)
